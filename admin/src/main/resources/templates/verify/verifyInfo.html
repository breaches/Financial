<!DOCTYPE html>
<html>
<head>
    <title>身份验证页面</title>
    <meta charset="UTF-8"/>
    <!--  VUE -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- elementUI -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>

<div id="app">
    <!-- 工具条  -->
    <div>
        姓名:
        <el-input v-model="empQuery.name" placeholder="请输入内容" clearable style="width:200px"></el-input>
        时间段:
        <el-date-picker v-model="empQuery.beginDate" type="date" placeholder="选择开始日期"></el-date-picker>
        -------
        <el-date-picker type="date" v-model="empQuery.endDate" placeholder="选择结束日期"></el-date-picker>
        <el-button icon="el-icon-search" @click="empSearch" circle></el-button>
    </div>

    <el-table :data="tableData" @selection-change="handleSelectionChange" stripe style="width: 100%">
        <el-table-column type="index"></el-table-column>
        <el-table-column type="selection" width="55"></el-table-column>
        <el-table-column prop="id" label="编号" width="180"></el-table-column>
        <el-table-column prop="name" label="用户名" width="180"></el-table-column>
        <el-table-column prop="time" :formatter="formatDate" label="认证时间" width="180"></el-table-column>


        <el-table-column prop="state" label="状态" :formatter="stateFormatter"></el-table-column>
        <el-table-column label="操作">
            <template slot-scope="scope">
                <el-button size="mini" type="success" @click="handleEdit(scope.row)">编辑</el-button>
            </template>
        </el-table-column>

    </el-table>
    <!-- 分页条  -->
    <div>
        <el-pagination @size-change="handleSizeChange" :current-page="empQuery.page"
                       @current-change="handleCurrentChange"
                       :page-sizes="[5, 10, 15, 20]" :page-size="100" layout="total, sizes, prev, pager, next, jumper"
                       :total="empTotal">
        </el-pagination>
    </div>

    <!-- 弹框 -->
    <el-dialog title="认证详情"   :before-close="handleClose"  :visible.sync="dialogVisible" width="850px">
        <table width="800px"  border="1px" cellpadding="0px"  cellspacing="0px">
            <tr height="50px">
                <th>姓名</td>
                <td>花花</td>
                <th>性别</td>
                <td>男</td>
                <th>身份证号</td>
                <td colspan="3">411426199706265520</td>
            </tr>
            <tr height="50px">
                <th>学历</td>
                <td>高中</td>
                <th>住房</th>
                <td>有</td>
                <th>婚姻</td>
                <td>单身</td>
                <th>收入</th>
                <td> 10k</td>

            </tr>
            <tr  height="50px" >
                <th>地址</td>
                <td colspan="7" >花花</td>

            </tr>
            <tr  height="150px" >
                <th>身份证正面照</td>
                <td colspan="3" width="200px"></td>
                <th>身份证反面照</td>
                <td colspan="3" width="200px"></td>
            </tr>
        </table>
        <br/>
        <p>认证是否通过？ 点击 通过 或 不通过<p>
        <el-radio v-model="radio" label="1"  @change="success" >通过</el-radio>
        <el-radio v-model="radio" label="2" @change="danger">不通过</el-radio>
        <el-input
                type="textarea"
                :rows="3"
                placeholder="请输入内容"
                v-model="textarea">
        </el-input>

		<div slot="footer" class="dialog-footer">
					<el-button @click="dialogVisible = false">关闭</el-button>
					<el-button type="primary" @click="changeEmp">提交</el-button>
        </div>
    </el-dialog>


</div>


<script type="text/javascript">
    var app = new Vue({
        el: "#app",
        data: {
            tableData: [],
            empQuery: {
                page: 1,
                count: 5,
                name: "",
                beginDate: "",
                endDate: ""
            },
            empTotal: 0,
            dialogVisible: false,
            empInfo: {},
            personInfo:{},
            textarea:"认证成功",
            radio:"1",


        },
        methods: {
            handleClose(done) {
                this.$confirm('确认关闭？')
                    .then(_ => {
                        done();
                    })
                    .catch(_ => {});
            },
            stateFormatter: function (row, column, cellValue, index) {
                return cellValue == 1 ? "待处理" : "处理成功";
            },
            handleSizeChange: function (val) {
                this.empQuery.count = val;
                this.empQuery.page = 1;
                reload();
            },
            handleCurrentChange: function (val) {
                this.empQuery.page = val;
                reload();
            },
            empSearch: function () {
                reload();
            },
            danger: function () {
                this.textarea = "@请重试，提交信息有误";
            },
            success: function () {
                this.textarea = "@认证成功";
            },
            handleEdit: function (user) {
                axios.get('verify/getDetailed?id=' + user.id)
                    .then(function (response) {
                        app.empInfo = response.data;
                        app.dialogVisible = true;
                    });

            },
            handleSelectionChange: function (val) {
                this.deleteArr = val;
            },
            changeEmp: function () {
                axios.post("audit/editAudit", app.empInfo)
                    .then(function (response) {
                        app.dialogVisible = false;
                        app.$message({
                            message: response.data.msg,
                            type: 'success'
                        });
                        reload();
                    });
            },
            formatDate: function (row, column, cellValue, index) {
                var date = new Date(cellValue);
                Y = date.getFullYear(),
                    m = date.getMonth() + 1,
                    d = date.getDate(),
                    H = date.getHours(),
                    i = date.getMinutes(),
                    s = date.getSeconds();
                if (m < 10) {
                    m = '0' + m;
                }
                if (d < 10) {
                    d = '0' + d;
                }
                if (H < 10) {
                    H = '0' + H;
                }
                if (i < 10) {
                    i = '0' + i;
                }
                if (s < 10) {
                    s = '0' + s;
                }
                var t = Y + '-' + m + '-' + d + ' ' + H + ':' + i;
                return t;
            }


        }
    });


    function reload() {
        axios.post('verify/getUserInfo', app.empQuery)
            .then(function (response) {
                app.tableData = response.data.data;
                app.empTotal = response.data.total;
            });
    }

    reload();


</script>
</body>
</html>

